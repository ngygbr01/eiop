<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raktár Információk | EIOP</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --bg-app: #f9f9f9; --bg-panel: #ffffff; --text-main: #1f2937; --text-muted: #6b7280; --border-subtle: #e5e7eb; --accent-color: #3b82f6; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background-color: var(--bg-app); color: var(--text-main); display: flex; flex-direction: column; }
        
        .app-header { flex: 0 0 64px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px); border-bottom: 1px solid var(--border-subtle); padding: 0 24px; display: flex; align-items: center; justify-content: space-between; z-index: 100; }
        .back-btn { display: flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text-main); font-weight: 600; font-size: 14px; padding: 8px 16px; border-radius: 8px; transition: background 0.2s; }
        .back-btn:hover { background: #f3f4f6; }
        .page-title { font-weight: 700; font-size: 18px; color: #111827; display: flex; align-items: center; gap: 10px; }

        .content-container { flex: 1; padding: 20px 40px; max-width: 1600px; margin: 0 auto; width: 100%; box-sizing: border-box; display: flex; flex-direction: column; overflow: hidden; }
        
        .stats-grid { flex: 0 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-panel); border-radius: 16px; padding: 20px; border: 1px solid var(--border-subtle); box-shadow: var(--shadow-soft); display: flex; flex-direction: column; gap: 5px; }
        .stat-label { font-size: 12px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; }
        .stat-value { font-size: 24px; font-weight: 800; color: #111827; }
        .stat-trend { font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px; }

        .table-panel { flex: 1; background: var(--bg-panel); border-radius: 16px; border: 1px solid var(--border-subtle); box-shadow: var(--shadow-soft); overflow: hidden; display: flex; flex-direction: column; }
        .panel-header { flex: 0 0 auto; padding: 16px 24px; border-bottom: 1px solid var(--border-subtle); display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .panel-title { font-weight: 700; font-size: 16px; }
        
        .table-scroll-area { flex: 1; overflow-y: auto; position: relative; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background: #f9fafb; color: var(--text-muted); font-weight: 600; text-align: left; padding: 12px 24px; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid var(--border-subtle); box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        td { padding: 10px 24px; border-bottom: 1px solid var(--border-subtle); color: var(--text-main); }
        tr:hover { background-color: #f8fafc; }
        
        .stock-badge { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #d1fae5; color: #065f46; }
        .stock-badge.low { background: #fee2e2; color: #991b1b; }
        
        .table-scroll-area::-webkit-scrollbar { width: 8px; height: 8px; }
        .table-scroll-area::-webkit-scrollbar-track { background: #f1f1f1; }
        .table-scroll-area::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
    </style>
</head>
<body>

    <header class="app-header">
        <a href="/" class="back-btn"><i data-lucide="arrow-left" width="18"></i> Vezérlőpult</a>
        <div class="page-title"><i data-lucide="package-search" style="color:var(--accent-color)"></i> Raktárkészlet</div>
        <div style="width: 100px;"></div>
    </header>

    <div class="content-container">
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Összes Termékfajta</div>
                <div class="stat-value" id="stat-count">-</div>
                <div class="stat-trend" style="color:var(--text-muted)">Raktáron lévő tételek</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Összes Készlet (db)</div>
                <div class="stat-value" id="stat-stock">-</div>
                <div class="stat-trend" style="color:var(--success)"><i data-lucide="package"></i> darab</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Készlet Érték (Becsült)</div>
                <div class="stat-value" id="stat-value">-</div>
                <div class="stat-trend" style="color:var(--accent-color)">HUF</div>
            </div>
        </div>

        <div class="table-panel">
            <div class="panel-header">
                <div class="panel-title">Terméklista</div>
                <button onclick="sessionStorage.removeItem('inventoryData'); window.location.href='/';" style="cursor:pointer; border:none; background:none; color:var(--danger); font-weight:600; font-size:12px;">
                    <i data-lucide="refresh-cw" width="12" style="vertical-align:middle"></i> Új lekérés
                </button>
            </div>
            
            <div class="table-scroll-area">
                <table id="inventory-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Cikkszám</th>
                            <th>Megnevezés</th>
                            <th>Készlet</th>
                            <th>Nettó Ár</th>
                            <th>Vonalkód</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        document.addEventListener("DOMContentLoaded", () => {
            const storedData = sessionStorage.getItem('inventoryData');
            if (storedData) {
                const data = JSON.parse(storedData);
                renderTable(data);
                calculateStats(data);
            } else {
                alert("Nincsenek betöltött adatok. Kérlek indítsd a lekérdezést a vezérlőpultról.");
                window.location.href = '/';
            }
        });

        function renderTable(products) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            products.forEach((p, index) => {
                const tr = document.createElement('tr');
                const badgeClass = p.stock < 5 ? 'low' : '';
                tr.innerHTML = `
                    <td style="color:var(--text-muted); font-size:12px;">${index + 1}.</td>
                    <td style="font-family:monospace; font-weight:600; color:var(--accent-color);">${p.sku}</td>
                    <td>${p.name}</td>
                    <td><span class="stock-badge ${badgeClass}">${p.stock} db</span></td>
                    <td style="font-weight:600;">${p.raw_price}</td>
                    <td style="color:var(--text-muted); font-size:12px;">${p.barcode}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function calculateStats(products) {
            const totalCount = products.length;
            const totalStock = products.reduce((sum, p) => sum + p.stock, 0);
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.price), 0);
            const fmt = (n) => n.toLocaleString('hu-HU');
            document.getElementById('stat-count').innerText = fmt(totalCount);
            document.getElementById('stat-stock').innerText = fmt(totalStock);
            document.getElementById('stat-value').innerText = fmt(totalValue) + " Ft";
        }
    </script>
</body>
</html>